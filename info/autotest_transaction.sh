#!/bin/bash

URL="http://localhost:8000/transactions"
AMOUNT="10000"

# Список отправителей (ID по убыванию)
SENDERS=(
"40817810111322111",
"40817810111322112",
"40817810111322113",
"40817810111322114",
"40817810111322115",
"40817810111322116",
"40817810111322117",
"40817810111322118",
"40817810111322119",
"40817810111322120",
"40817810111322121",
"40817810111322122",
"40817810111322123",
"40817810111322124",
"40817810111322125",
"40817810111322126",
"40817810111322127",
"40817810111322128",
"40817810111322129",
"40817810111322130",
"40817810111322131",
"40817810111322132",
"40817810111322133",
"40817810111322134",
"40817810111322135",
"40817810111322136",
"40817810111322137",
"40817810111322138",
"40817810111322139",
"40817810111322140",
"40817810111322141",
"40817810111322142",
"40817810111322143",
"40817810111322144",
"40817810111322145",
"40817810111322146",
"40817810111322147",
"40817810111322148",
"40817810111322149",
"40817810111322150",
"40817810111322151",
"40817810111322152",
"40817810111322153",
"40817810111322154",
"40817810111322155",
"40817810111322156",
"40817810111322157",
"40817810111322158",
"40817810111322159",
"40817810111322160",
"40817810111322161",
"40817810111322162",
"40817810111322163",
"40817810111322164",
"40817810111322165",
"40817810111322166",
"40817810111322167",
"40817810111322168",
"40817810111322169",
"40817810111322170",
"40817810111322171",
"40817810111322172",
"40817810111322173",
"40817810111322174",
"40817810111322175",
"40817810111322176",
"40817810111322177",
"40817810111322178",
"40817810111322179",
"40817810111322180",
"40817810111322181",
"40817810111322182",
"40817810111322183",
"40817810111322184",
"40817810111322185",
"40817810111322186",
"40817810111322187",
"40817810111322188",
"40817810111322189",
"40817810111322190",
"40817810111322191",
"40817810111322192",
"40817810111322193",
"40817810111322194",
"40817810111322195",
"40817810111322196",
"40817810111322197",
"40817810111322198",
"40817810111322199",
"40817810111322200",
"40817810111322201",
"40817810111322202",
"40817810111322203",
"40817810111322204",
"40817810111322205",
"40817810111322206",
"40817810111322207",
"40817810111322208",
"40817810111322209",
"40817810111322210",
"40817810111322211",
"40817810111322212"
)

# Список получателей (ID по возрастанию)
RECIPIENTS=(
"40817810111322212",
"40817810111322211",
"40817810111322210",
"40817810111322209",
"40817810111322208",
"40817810111322207",
"40817810111322206",
"40817810111322205",
"40817810111322204",
"40817810111322203",
"40817810111322202",
"40817810111322201",
"40817810111322200",
"40817810111322199",
"40817810111322198",
"40817810111322197",
"40817810111322196",
"40817810111322195",
"40817810111322194",
"40817810111322193",
"40817810111322192",
"40817810111322191",
"40817810111322190",
"40817810111322189",
"40817810111322188",
"40817810111322187",
"40817810111322186",
"40817810111322185",
"40817810111322184",
"40817810111322183",
"40817810111322182",
"40817810111322181",
"40817810111322180",
"40817810111322179",
"40817810111322178",
"40817810111322177",
"40817810111322176",
"40817810111322175",
"40817810111322174",
"40817810111322173",
"40817810111322172",
"40817810111322171",
"40817810111322170",
"40817810111322169",
"40817810111322168",
"40817810111322167",
"40817810111322166",
"40817810111322165",
"40817810111322164",
"40817810111322163",
"40817810111322162",
"40817810111322161",
"40817810111322160",
"40817810111322159",
"40817810111322158",
"40817810111322157",
"40817810111322156",
"40817810111322155",
"40817810111322154",
"40817810111322153",
"40817810111322152",
"40817810111322151",
"40817810111322150",
"40817810111322149",
"40817810111322148",
"40817810111322147",
"40817810111322146",
"40817810111322145",
"40817810111322144",
"40817810111322143",
"40817810111322142",
"40817810111322141",
"40817810111322140",
"40817810111322139",
"40817810111322138",
"40817810111322137",
"40817810111322136",
"40817810111322135",
"40817810111322134",
"40817810111322133",
"40817810111322132",
"40817810111322131",
"40817810111322130",
"40817810111322129",
"40817810111322128",
"40817810111322127",
"40817810111322126",
"40817810111322125",
"40817810111322124",
"40817810111322123",
"40817810111322122",
"40817810111322121",
"40817810111322120",
"40817810111322119",
"40817810111322118",
"40817810111322117",
"40817810111322116",
"40817810111322115",
"40817810111322114",
"40817810111322113",
"40817810111322112",
"40817810111322111"
)

# Количество транзакций на каждого отправителя
TX_PER_SENDER=1

# Количество повторений всего теста
REPEAT_COUNT=100

# Запускаем тестирование REPEAT_COUNT=*** раз
for ((repeat = 1; repeat <= REPEAT_COUNT; repeat++)); do
  echo "Запуск повторения #$repeat"

  for ((i = 0; i < ${#SENDERS[@]}; i++)); do
    SENDER="${SENDERS[$i]}"
    RECIPIENT="${RECIPIENTS[$i]}"

    for ((j = 1; j <= TX_PER_SENDER; j++)); do
      echo "Транзакция #$j: Отправитель $SENDER -> Получатель $RECIPIENT"

      curl -X 'POST' "$URL" \
        -H 'Content-Type: application/json' \
        -d "{
          \"amount\": \"$AMOUNT\",
          \"sender\": \"$SENDER\",
          \"recipient\": \"$RECIPIENT\"
        }" \
        --silent --output /dev/null &  # Фоновый процесс для ускорения

      sleep 0.01  # Небольшая пауза для уменьшения нагрузки на БД
    done
  done

  echo "✅ Повторение #$repeat завершено!"
done

echo "✅ Все тестирования завершены!"
